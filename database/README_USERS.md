# ุฅุนุฏุงุฏ ูุธุงู ุงููุณุชุฎุฏููู ูุงูุตูุงุญูุงุช

## ุฎุทูุงุช ุฅุนุฏุงุฏ ูุงุนุฏุฉ ุงูุจูุงูุงุช ูู Supabase

### 1. ุชูููุฐ ุงูุณูุฑูุจุช SQL

1. ุงูุชุญ ููุญุฉ ุชุญูู Supabase ุงูุฎุงุตุฉ ุจูุดุฑูุนู
2. ุงูุชูู ุฅูู **SQL Editor**
3. ุงูุณุฎ ูุญุชูู ููู `database/users_and_permissions.sql`
4. ุงูุตู ุงููุญุชูู ูู ูุญุฑุฑ SQL
5. ุงุถุบุท ุนูู **Run** ูุชูููุฐ ุงูุณูุฑูุจุช

ุณูููู ุงูุณูุฑูุจุช ุจุฅูุดุงุก:
- ุฌุฏูู `users` ูููุณุชุฎุฏููู
- ุฌุฏูู `user_permissions` ูุตูุงุญูุงุช ุงููุณุชุฎุฏููู
- ุงูุนูุงูุงุช ูุงูููุงุฑุณ ุงููุงุฒูุฉ
- ูุณุชุฎุฏู ูุฏูุฑ ุงูุชุฑุงุถู (username: admin, password: admin123)

### 2. ูููู ุงูุฌุฏุงูู

#### ุฌุฏูู `users`
```sql
- id (UUID, Primary Key)
- full_name (VARCHAR) - ุงูุงุณู ุงููุงูู
- phone_number (VARCHAR) - ุฑูู ุงููุงุชู
- address (TEXT) - ุงูุนููุงู
- age (INTEGER) - ุงูุนูุฑ
- permission_type (VARCHAR) - ููุน ุงูุตูุงุญูุฉ: ูุฏูุฑ | ูุญุงุณุจ | ููุธู
- username (VARCHAR, UNIQUE) - ุงุณู ุงููุณุชุฎุฏู
- password (VARCHAR) - ูููุฉ ุงููุฑูุฑ
- created_at (TIMESTAMP)
- updated_at (TIMESTAMP)
```

#### ุฌุฏูู `user_permissions`
```sql
- id (UUID, Primary Key)
- user_id (UUID, Foreign Key -> users.id)
- view_statistics (BOOLEAN) - ุตูุงุญูุฉ ุนุฑุถ ุงูุฅุญุตุงุฆูุงุช
- view_reports (BOOLEAN) - ุตูุงุญูุฉ ุนุฑุถ ุงูุชูุงุฑูุฑ
- view_services (BOOLEAN) - ุตูุงุญูุฉ ุนุฑุถ ุงูุฎุฏูุงุช
- view_people (BOOLEAN) - ุตูุงุญูุฉ ุนุฑุถ ูุงุฆูุฉ ุงูุฃุดุฎุงุต
- view_notifications (BOOLEAN) - ุตูุงุญูุฉ ุนุฑุถ ุงูุฅุดุนุงุฑุงุช
- add_purchase (BOOLEAN) - ุตูุงุญูุฉ ุฅุถุงูุฉ ุดุฑุงุก
- view_stores (BOOLEAN) - ุตูุงุญูุฉ ุนุฑุถ ุงููุฎุงุฒู
- created_at (TIMESTAMP)
- updated_at (TIMESTAMP)
```

### 3. ุฃููุงุน ุงูุตูุงุญูุงุช

#### 1. ูุฏูุฑ (Admin)
- ูุฏูู ุตูุงุญูุงุช ูุงููุฉ ุนูู ุฌููุน ุฃุฌุฒุงุก ุงููุธุงู
- ูุง ูุญุชุงุฌ ุฅูู ุฅุฏุฎุงู ูู ุฌุฏูู `user_permissions`
- ููููู ุฅุฏุงุฑุฉ ุงููุณุชุฎุฏููู ุงูุขุฎุฑูู ูุตูุงุญูุงุชูู

#### 2. ูุญุงุณุจ (Accountant)
ุตูุงุญูุงุช ูุงุจูุฉ ููุชุฎุตูุต:
- โ ุนุฑุถ ุงูุฅุญุตุงุฆูุงุช
- โ ุนุฑุถ ุงูุชูุงุฑูุฑ
- โ ุนุฑุถ ุงูุฎุฏูุงุช
- โ ุนุฑุถ ูุงุฆูุฉ ุงูุฃุดุฎุงุต

#### 3. ููุธู (Employee)
ุตูุงุญูุงุช ูุงุจูุฉ ููุชุฎุตูุต (ุฌููุน ุตูุงุญูุงุช ุงููุญุงุณุจ + ุฅุถุงููุฉ):
- โ ุนุฑุถ ุงูุฅุญุตุงุฆูุงุช
- โ ุนุฑุถ ุงูุชูุงุฑูุฑ
- โ ุนุฑุถ ุงูุฎุฏูุงุช
- โ ุนุฑุถ ูุงุฆูุฉ ุงูุฃุดุฎุงุต
- โ ุนุฑุถ ุงูุฅุดุนุงุฑุงุช ูู ุงูุตูุญุฉ ุงูุฑุฆูุณูุฉ
- โ ุนุฑุถ ุฒุฑ ุฅุถุงูุฉ ุดุฑุงุก
- โ ุนุฑุถ ุงููุฎุงุฒู

### 4. ุงุณุชุฎุฏุงู ุงููุธุงู

#### ุฅุถุงูุฉ ูุณุชุฎุฏู ุฌุฏูุฏ
1. ุงูุชูู ุฅูู ุตูุญุฉ "ุงููุณุชุฎุฏููู ูุงูุตูุงุญูุงุช"
2. ุงุถุบุท ุนูู ุฒุฑ "ุฅุถุงูุฉ"
3. ุงููุฃ ุงููุนูููุงุช ุงูุฃุณุงุณูุฉ:
   - ุงูุงุณู ุงููุงูู (ูุทููุจ)
   - ุฑูู ุงููุงุชู
   - ุงูุนููุงู
   - ุงูุนูุฑ
4. ุฃุฏุฎู ุจูุงูุงุช ุชุณุฌูู ุงูุฏุฎูู:
   - ุงุณู ุงููุณุชุฎุฏู (ูุทููุจ ููุฑูุฏ)
   - ูููุฉ ุงููุฑูุฑ (ูุทููุจ)
5. ุงุฎุชุฑ ููุน ุงูุตูุงุญูุฉ:
   - **ูุฏูุฑ**: ุตูุงุญูุงุช ูุงููุฉ
   - **ูุญุงุณุจ**: ุงุฎุชุฑ ุงูุฃุฌุฒุงุก ุงููุณููุญ ูู ุจูุดุงูุฏุชูุง
   - **ููุธู**: ุงุฎุชุฑ ุงูุฃุฌุฒุงุก ูุงูููุฒุงุช ุงููุณููุญ ูู ุจูุง
6. ุงุถุบุท "ุญูุธ"

#### ุนุฑุถ ุงููุณุชุฎุฏููู
- ุงูุฌุฏูู ูุนุฑุถ ุฌููุน ุงููุณุชุฎุฏููู ูุน ุชูุงุตูููู
- ูููู ุงูุจุญุซ ุจุงูุงุณูุ ุฑูู ุงููุงุชูุ ุงุณู ุงููุณุชุฎุฏูุ ุฃู ุงูุนููุงู
- ูููู ุชุญุฏูุฏ ุนุฏุฉ ูุณุชุฎุฏููู ููุญุฐู ุงูุฌูุงุนู
- ุนุฑุถ/ุฅุฎูุงุก ูููุงุช ุงููุฑูุฑ

#### ุชุนุฏูู ูุณุชุฎุฏู
- ุงุถุบุท ุนูู ุฃููููุฉ ุงูุชุนุฏูู ุจุฌุงูุจ ุงููุณุชุฎุฏู
- ูู ุจุชุญุฏูุซ ุงูุจูุงูุงุช ูุงูุตูุงุญูุงุช
- ุงุญูุธ ุงูุชุบููุฑุงุช

#### ุญุฐู ูุณุชุฎุฏู
- ุงุถุบุท ุนูู ุฃููููุฉ ุงูุญุฐู ุจุฌุงูุจ ุงููุณุชุฎุฏู
- ุฃูุฏ ุนูููุฉ ุงูุญุฐู
- ุณูุชู ุญุฐู ุงููุณุชุฎุฏู ูุตูุงุญูุงุชู ุชููุงุฆูุงู

### 5. ุงููููุงุช ุงููุชุนููุฉ

```
app/
  users-permissions/
    page.tsx                 # ุตูุญุฉ ุนุฑุถ ุงููุณุชุฎุฏููู
    add/
      page.tsx              # ุตูุญุฉ ุฅุถุงูุฉ ูุณุชุฎุฏู ุฌุฏูุฏ
lib/
  users-operations.ts       # ุฏูุงู ุงูุนูููุงุช ุนูู ุงููุณุชุฎุฏููู
database/
  users_and_permissions.sql # ุณูุฑูุจุช ุฅูุดุงุก ุงูุฌุฏุงูู
```

### 6. ุงูุฃูุงู

โ๏ธ **ููุงุญุธุงุช ุฃูููุฉ ูููุฉ:**

1. **ูููุงุช ุงููุฑูุฑ**: ุญุงููุงู ูุชู ุชุฎุฒูู ูููุงุช ุงููุฑูุฑ ููุต ุนุงุฏู. ูููุตุญ ุจุดุฏุฉ ุจุชุดููุฑูุง ุจุงุณุชุฎุฏุงู bcrypt ุฃู ููุชุจุฉ ูุดุงุจูุฉ ูุจู ุงูุฅูุชุงุฌ.

2. **Row Level Security (RLS)**: ุงูุณูุฑูุจุช ููุนูู RLS ุนูู ุงูุฌุฏุงูู. ูุฏ ุชุญุชุงุฌ ูุชุนุฏูู ุงูุณูุงุณุงุช ุญุณุจ ุงุญุชูุงุฌุงุชู.

3. **ุงูุชุญูู ูู ุงูุตูุงุญูุงุช**: ุนูุฏ ุชุทุจูู ูุธุงู ุชุณุฌูู ุงูุฏุฎููุ ุชุฃูุฏ ูู ุงูุชุญูู ูู ุตูุงุญูุงุช ุงููุณุชุฎุฏู ูุจู ุนุฑุถ ุฃู ูุญุชูู ุญุณุงุณ.

### 7. ุงูุฎุทูุงุช ุงูุชุงููุฉ

ูุชุทุจูู ูุธุงู ุชุณุฌูู ุงูุฏุฎูู ุงููุงูู:

1. ุฅูุดุงุก ุตูุญุฉ ุชุณุฌูู ุงูุฏุฎูู
2. ุฅูุดุงุก Context/Provider ูููุณุชุฎุฏู ุงูุญุงูู
3. ุฅูุดุงุก ุฏูุงู ููุชุญูู ูู ุงูุตูุงุญูุงุช
4. ุชุทุจูู ุญูุงูุฉ ุนูู ุงูุตูุญุงุช ุญุณุจ ุงูุตูุงุญูุงุช
5. ุฅุฎูุงุก/ุฅุธูุงุฑ ุงูุฃุฒุฑุงุฑ ูุงูุฃูุณุงู ุญุณุจ ุตูุงุญูุงุช ุงููุณุชุฎุฏู ุงููุณุฌู

### 8. ูุซุงู ุนูู ุงูุชุญูู ูู ุงูุตูุงุญูุงุช

```typescript
// ูู ุฃู ุตูุญุฉ ุฃู ูููู
function hasPermission(user: UserWithPermissions, permission: string): boolean {
  // ุงููุฏูุฑ ูุฏูู ูู ุงูุตูุงุญูุงุช
  if (user.permission_type === 'ูุฏูุฑ') {
    return true
  }
  
  // ุงูุชุญูู ูู ุงูุตูุงุญูุฉ ุงููุญุฏุฏุฉ
  if (user.permissions) {
    return user.permissions[permission] === true
  }
  
  return false
}

// ุงุณุชุฎุฏุงู
{hasPermission(currentUser, 'view_statistics') && (
  <Link href="/stats/comprehensive">
    <Button>ุงูุฅุญุตุงุฆูุงุช ุงูุดุงููุฉ</Button>
  </Link>
)}
```

### 9. ุงูุฏุนู ูุงููุณุงุนุฏุฉ

ุฅุฐุง ูุงุฌูุช ุฃู ูุดุงูู:
1. ุชุญูู ูู ุฃู ุงูุฌุฏุงูู ุชู ุฅูุดุงุคูุง ุจุดูู ุตุญูุญ ูู Supabase
2. ุชุฃูุฏ ูู ุตุญุฉ ูุชุบูุฑุงุช ุงูุจูุฆุฉ (SUPABASE_URL, SUPABASE_ANON_KEY)
3. ุฑุงุฌุน console ููุฃุฎุทุงุก
4. ุชุญูู ูู ุณูุงุณุงุช RLS ูู Supabase

---

ุชู ุฅูุดุงุก ุงููุธุงู ุจูุฌุงุญ! ๐
